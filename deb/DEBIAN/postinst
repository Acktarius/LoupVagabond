#!/bin/bash
set -e

# Make the main script executable
chmod 755 /usr/local/bin/loupvagabond

# Handle proxychains4 configuration
if [ -f /etc/proxychains4.conf ]; then
    echo "Backing up existing proxychains4.conf..."
    mkdir -p /etc/loupvagabond
    cp /etc/proxychains4.conf /etc/loupvagabond/proxychains4.conf.backup
fi

# Install our proxychains4 configuration
echo "Installing LoupVagabond's proxychains4 configuration..."
cp /etc/loupvagabond/proxychains4.conf.example /etc/proxychains4.conf

# Enable Tor service but don't start it (respect user's decision)
echo "Enabling Tor service on system boot..."
systemctl enable tor.service

# Check if service is already running before trying to start it
if ! systemctl is-active --quiet tor.service; then
    systemctl start tor.service
else
    echo "Tor service is already running."
fi

# Update desktop database
if [ -x "$(command -v update-desktop-database)" ]; then
    update-desktop-database -q
fi

# Notify of successful installation
echo "LoupVagabond has been successfully installed!"
echo "You can now run it from your application menu or by typing 'loupvagabond' in the terminal."

exit 0
